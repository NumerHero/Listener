"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),$handlers_key=Symbol("$handlers_key"),Util=function(){function e(){_classCallCheck(this,e);var t=arguments.length<=0?void 0:arguments[0],r=this;if(this[$handlers_key]={},t)switch(r.testType(t)){case"[object Object]":return Object.assign(r,t)}}return _createClass(e,[{key:"testType",value:function(e){return Object.prototype.toString.call(e)}},{key:"publish",value:function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];try{var s=function(){var r=t,i=t.RegAnalyse(e),s=i.ev,a=i.className;if(!t.isHas(s,a))return{v:void 0};if(a)t[$handlers_key][s][a].forEach(function(e){return e.apply(r,n)});else{var o=!0,l=!1,c=void 0;try{for(var u,y=Object.keys(t[$handlers_key][s])[Symbol.iterator]();!(o=(u=y.next()).done);o=!0){var h=u.value;t[$handlers_key][s][h].forEach(function(e){return e.apply(r,n)})}}catch(e){l=!0,c=e}finally{try{!o&&y.return&&y.return()}finally{if(l)throw c}}}}();if("object"===("undefined"==typeof s?"undefined":_typeof(s)))return s.v}catch(e){throw new Error(e)}return this}},{key:"once",value:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.publish.apply(this,[e].concat(r)),this.unsubscribe(e)}},{key:"subscribe",value:function(e,t){this.isString(e);var r=this.RegAnalyse(e),n=r.ev,i=r.className;if(!n)throw new Error("listenerName must only combine with only character、number and _  ");if(/^default$/.test(i))throw new Error("default eventClass was binded !");return!(n in this[$handlers_key])&&(this[$handlers_key][n]={default:[]}),i?this[$handlers_key][n][i]?this[$handlers_key][n][i].push(t):this[$handlers_key][n][i]=[t]:this[$handlers_key][n].default.push(t),this}},{key:"unsubscribe",value:function(e){this.isString(e);var t=this.RegAnalyse(e),r=t.ev,n=t.className;if(this.isHas(r,n))return n?delete this[$handlers_key][r][n]:delete this[$handlers_key][r],this}},{key:"isHas",value:function(e,t){if(e in this[$handlers_key]&&(!t||t in this[$handlers_key][e]))return!0;throw new Error("The Event didnt bind !")}},{key:"RegAnalyse",value:function(e){var t=/^(\w+)(\.(\w+))?$/.exec(e),r=t[1],n=t[3];return{className:n,ev:r}}},{key:"isString",value:function(e){if("string"!=typeof e)throw new Error("EventName must is a string !")}},{key:"find",value:function(e){var t=this;if("[object String]"!==t.testType(e))return void console.error("params must be string!");var r=e.split("."),n=null,i=null;try{r.length>1?r.reduce(function(e,t){if(e.hasOwnProperty(t))return n=e,i=t,e[t];throw Error("Doesnt find this property! Please cleck this property name was right!")},t):(n=t,i=r[0])}catch(e){console.error(e)}return{$p:n,$c:i}}},{key:"bindSetterandGetter",value:function(e,t,r,n){var i=e[t];Object.defineProperty(e,t,{get:function(){return n?n.call(this,i):i},set:function(e){i=r?r.call(this,e):e}})}},{key:"watch",value:function(e,t,r,n){var i=this,s=t.deep,a=this.find(e),o=a.$p,l=a.$c;if(s){var c=i.testType(o[l]);"[object Object]"===c||"[object Array]"===c?i.tree(o[l],function(e,t,r,n){i.bindSetterandGetter(e,t,r,n)},r,n):console.error("deep-bind root must is a object or array")}else i.bindSetterandGetter(o,l,r,n)}},{key:"tree",value:function(e,t,r,n){var i=this;for(var s in e){var a=i.testType(e[s]);"[object Object]"!==a&&"[object Array]"!==a||i.tree(e[s],t,r,n),t(e,s,r,n)}}}]),e}();module.exports=Util;